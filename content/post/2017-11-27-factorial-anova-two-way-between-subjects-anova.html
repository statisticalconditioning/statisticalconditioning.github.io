---
title: 'Factorial Anova: Two-Way Between Subjects ANOVA'
draft: true
author: William Murrah
date: '2017-11-27'
tags:
  - ERMA7300
slug: factorial-anova-two-way-between-subjects-anova
---



<pre class="r"><code>library(knitr)
library(AMCP)
library(car)</code></pre>
<pre><code>## Loading required package: carData</code></pre>
<pre class="r"><code>library(pander)
library(ztable)</code></pre>
<pre><code>## Welcome to package ztable ver 0.1.8</code></pre>
<pre class="r"><code>library(emmeans)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ───────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 2.2.1     ✔ purrr   0.2.4
## ✔ tibble  1.4.2     ✔ dplyr   0.7.4
## ✔ tidyr   0.8.0     ✔ stringr 1.3.0
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ──────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ✖ dplyr::recode() masks car::recode()
## ✖ purrr::some()   masks car::some()</code></pre>
<pre class="r"><code>opts_chunk$set(echo = TRUE, comment = NULL, highlight = FALSE)
options(ztable.type = &quot;html&quot;)
options(scipen=1, digits=3)

data(C7T5)
df &lt;- within(C7T5, {
  Feedback &lt;- factor(Feedback)
  Drug     &lt;- factor(Drug)
})</code></pre>
<div id="anova" class="section level1">
<h1>ANOVA</h1>
<p>Some text.</p>
<pre class="text"><code>mod &lt;- lm(Score ~ Feedback*Drug, df)
summary(mod)</code></pre>
<pre><code>
Call:
lm(formula = Score ~ Feedback * Drug, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-20.00  -8.75  -1.50  10.75  18.00 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       170.00       5.58   30.46  &lt; 2e-16 ***
Feedback2          16.00       7.89    2.03  0.05390 .  
Drug2              33.00       7.89    4.18  0.00033 ***
Drug3              18.00       7.89    2.28  0.03175 *  
Feedback2:Drug2   -18.00      11.16   -1.61  0.11992    
Feedback2:Drug3     6.00      11.16    0.54  0.59586    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 12.5 on 24 degrees of freedom
Multiple R-squared:  0.585, Adjusted R-squared:  0.499 
F-statistic: 6.78 on 5 and 24 DF,  p-value: 0.000453</code></pre>
<pre class="text"><code>avmod &lt;- aov(mod)
summary(avmod)</code></pre>
<pre><code>          Df Sum Sq Mean Sq F value  Pr(&gt;F)    </code></pre>
<p>Feedback 1 1080 1080 6.93 0.01456 *<br />
Drug 2 3420 1710 10.98 0.00041 *** Feedback:Drug 2 780 390 2.50 0.10288<br />
Residuals 24 3738 156<br />
— Signif. codes: 0 ‘<em><strong>’ 0.001 ’</strong>’ 0.01 ’</em>’ 0.05 ‘.’ 0.1 ‘’ 1</p>
</div>
<div id="other-stuff" class="section level1">
<h1>Other stuff</h1>
<pre class="text"><code>emmeans(mod, &quot;Drug&quot;)</code></pre>
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code> Drug emmean   SE df lower.CL upper.CL
 1       178 3.95 24      170      186
 2       202 3.95 24      194      210
 3       199 3.95 24      191      207

Results are averaged over the levels of: Feedback 
Confidence level used: 0.95 </code></pre>
<pre class="text"><code>emmeans(mod, &quot;Feedback&quot;)</code></pre>
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code> Feedback emmean   SE df lower.CL upper.CL
 1           187 3.22 24      180      194
 2           199 3.22 24      192      206

Results are averaged over the levels of: Drug 
Confidence level used: 0.95 </code></pre>
<pre class="text"><code>emmip(mod, Feedback ~ Drug)</code></pre>
<p><img src="/post/2017-11-27-factorial-anova-two-way-between-subjects-anova_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="text"><code>emmip(mod, Drug ~ Feedback)</code></pre>
<p><img src="/post/2017-11-27-factorial-anova-two-way-between-subjects-anova_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="text"><code>emmod &lt;- emmeans(mod, pairwise ~ Drug)</code></pre>
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre class="text"><code>emmod</code></pre>
<pre><code>$emmeans
 Drug emmean   SE df lower.CL upper.CL
 1       178 3.95 24      170      186
 2       202 3.95 24      194      210
 3       199 3.95 24      191      207

Results are averaged over the levels of: Feedback 
Confidence level used: 0.95 

$contrasts
 contrast estimate   SE df t.ratio p.value
 1 - 2         -24 5.58 24  -4.300  0.0007
 1 - 3         -21 5.58 24  -3.763  0.0027
 2 - 3           3 5.58 24   0.538  0.8537

Results are averaged over the levels of: Feedback 
P value adjustment: tukey method for comparing a family of 3 estimates </code></pre>
<p>More text.</p>
<p>{{% alert note %}} Can this note contain <code>code</code> {{% /alert %}}</p>
<div id="another-example" class="section level2">
<h2>another Example</h2>
<pre class="text"><code>n = 25
Beta_0 = 70 # 80
Beta_tx = 10 # 9
Beta_sch = 15 # 15
Beta_ab = -12 # -12

Tx &lt;- rep(c(0, 1, 0, 1), each = n)
Sch &lt;- rep(c(0, 1), each = 2*n)
set.seed(20171024)
y &lt;- Beta_0 + Beta_tx*Tx + Beta_sch*Sch + Beta_ab*Tx*Sch + rnorm(2*n, 0, 15)
df &lt;- data.frame(y = round(y, 1), 
                 Tx = factor(Tx, labels = c(&quot;control&quot;, &quot;treatment&quot;)), 
                 Sch = factor(Sch, labels = c(&quot;public&quot;, &quot;private&quot;)))</code></pre>
<pre class="text"><code>df %&gt;% 
  group_by(Tx) %&gt;% 
  summarise(Mean_y = mean(y),
            SD_y = sd(y))</code></pre>
<pre><code># A tibble: 2 x 3
  Tx        Mean_y  SD_y
  &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 control     74.2  18.0
2 treatment   82.3  12.5</code></pre>
<pre class="text"><code>df %&gt;% 
  group_by(Sch) %&gt;% 
  summarise(mean_y = mean(y),
            SD_y = sd(y))</code></pre>
<pre><code># A tibble: 2 x 3
  Sch     mean_y  SD_y
  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 public    73.7  16.1
2 private   82.7  14.5</code></pre>
<pre class="text"><code>mod &lt;- lm(y ~ Tx*Sch, df)
summary(mod)</code></pre>
<pre><code>
Call:
lm(formula = y ~ Tx * Sch, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-30.26 -10.56  -0.63   9.64  40.19 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               66.71       2.92   22.84  &lt; 2e-16 ***
Txtreatment               14.05       4.13    3.40  0.00098 ***
Schprivate                15.00       4.13    3.63  0.00045 ***
Txtreatment:Schprivate   -12.00       5.84   -2.05  0.04265 *  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Residual standard error: 14.6 on 96 degrees of freedom
Multiple R-squared:  0.182, Adjusted R-squared:  0.156 
F-statistic:  7.1 on 3 and 96 DF,  p-value: 0.000232</code></pre>
<pre class="text"><code>anova(mod)</code></pre>
<pre><code>Analysis of Variance Table

Response: y
          Df Sum Sq Mean Sq F value Pr(&gt;F)   
Tx         1   1619    1619    7.59 0.0070 **
Sch        1   2025    2025    9.50 0.0027 **
Tx:Sch     1    900     900    4.22 0.0427 * 
Residuals 96  20471     213                  
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="text"><code>emmeans(mod, &quot;Sch&quot;)</code></pre>
<pre><code>NOTE: Results may be misleading due to involvement in interactions</code></pre>
<pre><code> Sch     emmean   SE df lower.CL upper.CL
 public    73.7 2.07 96     69.6     77.8
 private   82.7 2.07 96     78.6     86.8

Results are averaged over the levels of: Tx 
Confidence level used: 0.95 </code></pre>
<pre class="text"><code>pmmip(mod, Tx ~ Sch)  + ylim(0, 100)</code></pre>
<p><img src="/post/2017-11-27-factorial-anova-two-way-between-subjects-anova_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="text"><code>pmmip(mod, Sch ~ Tx)  + ylim(0, 100)</code></pre>
<p><img src="/post/2017-11-27-factorial-anova-two-way-between-subjects-anova_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="controling-familywise-alpha-level-in-factorial-anova" class="section level2">
<h2>Controling Familywise Alpha level in Factorial ANOVA</h2>
</div>
<div id="measuring-effects" class="section level2">
<h2>Measuring Effects</h2>
<p><span class="math display">\[
R^2_{\text{partial}} = \frac{SS_{\text{effect}}}{SS_W + SS_{\text{effect}}}
\]</span></p>
<p><span class="math display">\[
R^2_{\text{A,partial}} = \frac{SS_A}{SS_W + SS_A}
\]</span> <span class="math display">\[
R^2_{\text{AB, partial}} = \frac{SS_{AB}}{SS_W + SS_{AB}}
\]</span></p>
<p>For type of drug:</p>
<p><span class="math display">\[
R^2_{\text{drug,partial}} = \frac{SS_{\text{drug}}}{SS_W + SS_{\text{drug}}} = \frac{3420}{3738 + 3420} = 0.48
\]</span> ## Follow-up Analyses</p>
<div id="futher-main-effects-analyses" class="section level3">
<h3>Futher Main Effects Analyses</h3>
</div>
<div id="exploring-interactions-with-simple-effects" class="section level3">
<h3>Exploring Interactions with Simple Effects</h3>
</div>
</div>
</div>
